<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CreatorLink</title>
  <meta name="description" content="The premium platform connecting Roblox developers with verified YouTubers and creators."/>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.paddle.com/paddle/v2/paddle.js"></script>
  <script type="text/javascript">
  Paddle.Initialize({
    token: 'live_d9b7387e8fa6a1082464f7f6c25' // replace with a client-side token
  });
</script>
  <style>
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; }
    ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #555; }
    .glass { background: rgba(255, 255, 255, 0.8); border: 1px solid rgba(255, 255, 255, 0.2); }
    .dark .glass { background: rgba(0, 0, 0, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); }
    .gradient-text { background: linear-gradient(to right, #6366f1, #a855f7); -webkit-background-clip: text; color: transparent; }
    .animate-fadeIn { animation: fadeIn 0.5s ease-in-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .shadow-glow { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }
    .hover-lift { transition: transform 0.3s ease; }
    .hover-lift:hover { transform: translateY(-5px); }
    .btn-primary { background: #6366f1; color: white; padding: 1rem 2rem; border-radius: 0.75rem; font-weight: bold; transition: background 0.3s; }
    .btn-primary:hover { background: #4f46e5; }
    .btn-secondary { background: #e5e7eb; color: #111827; padding: 1rem 2rem; border-radius: 0.75rem; font-weight: bold; transition: background 0.3s; }
    .btn-secondary:hover { background: #d1d5db; }
    .dark .btn-secondary { background: #374151; color: #f9fafb; }
    .dark .btn-secondary:hover { background: #4b5563; }
    .tab { cursor: pointer; padding: 0.5rem 1rem; border-bottom: 2px solid transparent; }
    .tab.active { border-bottom-color: #6366f1; font-weight: bold; }
    .request-card { background: white; color: black; padding: 1.5rem; border-radius: 1rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
    .dark .request-card { background: #1f2937; color: white; }
    .archive-section { margin-top: 2rem; }
    /* Improved design: larger fonts, better spacing */
    h1 { font-size: 3rem; }
    h2 { font-size: 2.5rem; }
    h3 { font-size: 2rem; }
    p { font-size: 1.125rem; }
    .max-w-7xl { max-width: 90rem; } /* Wider container */
  </style>
</head>
<body class="min-h-screen bg-gray-50 dark:bg-black text-gray-900 dark:text-white transition-colors duration-500 antialiased">
  <!-- Fixed Navbar -->
  <nav class="fixed top-0 left-0 right-0 z-50 glass border-b border-gray-200/50 dark:border-gray-800/50 shadow-md">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center space-x-8">
          <a href="#" onclick="route('home')" class="flex items-center space-x-3 group hover:opacity-90 transition">
            <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
              <span class="text-white font-black text-xl">CL</span>
            </div>
            <span class="font-bold text-2xl tracking-tight gradient-text">CreatorLink</span>
          </a>
          <div class="hidden md:flex items-center space-x-6">
            <a href="#" onclick="route('creators')" class="text-base font-medium hover:text-indigo-600 dark:hover:text-indigo-400 transition">Creators</a>
            <a href="#" onclick="route('how-it-works')" class="text-base font-medium hover:text-indigo-600 dark:hover:text-indigo-400 transition">How it Works</a>
            <a href="#" onclick="route('dashboard')" id="nav-dashboard" class="text-base font-medium hover:text-indigo-600 dark:hover:text-indigo-400 transition hidden">Dashboard</a>
            <a href="#" onclick="route('admin')" id="nav-admin" class="text-base font-medium hover:text-indigo-600 dark:hover:text-indigo-400 transition hidden">Admin</a>
          </div>
        </div>
        <div class="flex items-center space-x-4">
          <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition focus:outline-none focus:ring-2 focus:ring-indigo-500">
            <svg id="sun" class="w-6 h-6 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
            <svg id="moon" class="w-6 h-6 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
          </button>
          <div id="auth-buttons" class="flex items-center space-x-3">
            <button onclick="route('auth')" class="px-4 py-2 text-base font-medium hover:text-indigo-600 dark:hover:text-indigo-400 transition">Log in</button>
            <button onclick="route('auth')" class="px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-base font-medium rounded-lg transition shadow-md">Get Started</button>
          </div>
          <div id="user-menu" class="hidden relative flex items-center space-x-2">
            <button id="user-menu-btn" class="flex items-center space-x-3 hover:opacity-80 transition focus:outline-none">
              <img id="user-avatar" src="https://via.placeholder.com/40" alt="User avatar" class="w-10 h-10 rounded-full object-cover border-2 border-gray-300 dark:border-gray-700 shadow-sm">
              <span id="user-name" class="font-medium text-base"></span>
              <span id="notif-badge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full px-2 py-0.5 min-w-[1.5rem] text-center"></span>
            </button>
            <button id="dropdown-toggle" class="p-1 text-gray-500 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 focus:outline-none">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div id="user-dropdown" class="hidden absolute top-full right-0 mt-2 w-48 glass rounded-xl py-2 shadow-xl z-50">
              <a href="#" onclick="route('dashboard')" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800">Dashboard</a>
              <a href="#" onclick="route('messages')" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800">Messages</a>
              <a href="#" onclick="route('notifications')" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800">Notifications</a>
              <a href="#" onclick="logout()" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800">Logout</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>
  <!-- Main Content -->
  <main class="pt-20 min-h-screen">
    <!-- Home Page -->
    <div id="page-home" class="page">
      <section class="relative overflow-hidden bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 h-[80vh] flex items-center justify-center">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
        <div class="relative z-10 max-w-7xl mx-auto px-6 text-center animate-fadeIn">
          <h1 class="text-6xl md:text-8xl font-black tracking-tight text-white mb-8 leading-tight">
            Promote Your Roblox Game<br>With <span class="gradient-text">Top Creators</span>
          </h1>
          <p class="text-2xl md:text-3xl text-white/90 mb-12 max-w-4xl mx-auto">
            CreatorLink connects Roblox developers with verified YouTubers and content creators. Get real players, real growth.
          </p>
          <div class="flex flex-col sm:flex-row gap-6 justify-center">
            <button onclick="route('creators')" class="btn-primary shadow-glow hover-lift">Browse Creators</button>
            <button onclick="openOnboardingModal('creator')" class="btn-secondary shadow-glow hover-lift">Become a Creator</button>
          </div>
        </div>
      </section>
      <!-- Features Section -->
      <section class="py-24 bg-white dark:bg-gray-900">
        <div class="max-w-7xl mx-auto px-6">
          <h2 class="text-5xl font-bold text-center mb-16 gradient-text">Why CreatorLink?</h2>
          <div class="grid md:grid-cols-3 gap-12">
            <div class="glass p-8 rounded-2xl text-center hover-lift shadow-glow">
              <div class="w-16 h-16 mx-auto mb-6 bg-indigo-100 dark:bg-indigo-900 rounded-full flex items-center justify-center">
                <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path></svg>
              </div>
              <h3 class="text-2xl font-bold mb-4">Verified Creators</h3>
              <p class="text-lg text-gray-600 dark:text-gray-300">Only the best, hand-verified YouTubers and creators.</p>
            </div>
            <div class="glass p-8 rounded-2xl text-center hover-lift shadow-glow">
              <div class="w-16 h-16 mx-auto mb-6 bg-indigo-100 dark:bg-indigo-900 rounded-full flex items-center justify-center">
                <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
              </div>
              <h3 class="text-2xl font-bold mb-4">Secure Payments</h3>
              <p class="text-lg text-gray-600 dark:text-gray-300">Pay securely with Paddle for promotions.</p>
            </div>
            <div class="glass p-8 rounded-2xl text-center hover-lift shadow-glow">
              <div class="w-16 h-16 mx-auto mb-6 bg-indigo-100 dark:bg-indigo-900 rounded-full flex items-center justify-center">
                <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5z"></path></svg>
              </div>
              <h3 class="text-2xl font-bold mb-4">Real-Time Chat</h3>
              <p class="text-lg text-gray-600 dark:text-gray-300">Communicate instantly with creators.</p>
            </div>
          </div>
        </div>
      </section>
    </div>
    <!-- Creator Onboarding Modal -->
    <div id="onboarding-modal-creator" class="fixed inset-0 bg-black/70 z-[100] hidden flex items-center justify-center p-4 overflow-y-auto">
      <div class="glass max-w-3xl w-full rounded-3xl p-10 m-4 animate-fadeIn shadow-2xl">
        <div class="flex justify-between items-center mb-8">
          <h2 class="text-4xl font-bold gradient-text">Become a Creator</h2>
          <button onclick="closeOnboardingModal('creator')" class="text-3xl hover:text-red-500 transition">&times;</button>
        </div>
        <form id="creator-onboarding-form" class="space-y-8">
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <label class="block text-base font-medium mb-2">YouTube Channel Name</label>
              <input type="text" name="channel_name" required placeholder="e.g. Flamingo" class="w-full px-5 py-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-indigo-500">
            </div>
            <div>
              <label class="block text-base font-medium mb-2">Channel URL</label>
              <input type="url" name="channel_url" required placeholder="https://youtube.com/@" class="w-full px-5 py-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-indigo-500">
            </div>
          </div>
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <label class="block text-base font-medium mb-2">Subscriber Count</label>
              <input type="number" name="subscribers" required placeholder="125000" class="w-full px-5 py-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-indigo-500">
            </div>
            <div>
              <label class="block text-base font-medium mb-2">Minimum Price per Video ($)</label>
              <input type="number" name="price_min" required placeholder="500" class="w-full px-5 py-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-indigo-500">
            </div>
          </div>
          <div>
            <label class="block text-base font-medium mb-2">Bio</label>
            <textarea name="bio" rows="4" placeholder="Tell us about your channel..." class="w-full px-5 py-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-indigo-500"></textarea>
          </div>
          <div>
            <label class="block text-base font-medium mb-2">Niches (select all that apply)</label>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              ${['Tycoon', 'Simulator', 'Obby', 'Roleplay', 'Horror', 'PvP', 'Adventure', 'Fighting'].map(n => `
                <label class="flex items-center space-x-3 cursor-pointer">
                  <input type="checkbox" value="${n}" class="rounded text-indigo-600 focus:ring-indigo-500">
                  <span class="text-base">${n}</span>
                </label>
              `).join('')}
            </div>
          </div>
          <div class="flex gap-6 mt-10">
            <button type="submit" class="flex-1 py-4 btn-primary shadow-glow hover-lift">Submit Application</button>
            <button type="button" onclick="closeOnboardingModal('creator')" class="flex-1 py-4 btn-secondary">Cancel</button>
          </div>
        </form>
      </div>
    </div>
    <!-- Developer Onboarding Modal -->
    <div id="onboarding-modal-developer" class="fixed inset-0 bg-black/70 z-[100] hidden flex items-center justify-center p-4 overflow-y-auto">
      <div class="glass max-w-3xl w-full rounded-3xl p-10 m-4 animate-fadeIn shadow-2xl">
        <div class="flex justify-between items-center mb-8">
          <h2 class="text-4xl font-bold gradient-text">Become a Developer</h2>
          <button onclick="closeOnboardingModal('developer')" class="text-3xl hover:text-red-500 transition">&times;</button>
        </div>
        <form id="developer-onboarding-form" class="space-y-8">
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <label class="block text-base font-medium mb-2">Roblox Username</label>
              <input type="text" name="roblox_username" required placeholder="e.g. Developer123" class="w-full px-5 py-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-indigo-500">
            </div>
            <div>
              <label class="block text-base font-medium mb-2">Game Name</label>
              <input type="text" name="game_name" required placeholder="e.g. My Awesome Game" class="w-full px-5 py-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-indigo-500">
            </div>
          </div>
          <div>
            <label class="block text-base font-medium mb-2">Game Description</label>
            <textarea name="game_desc" rows="4" placeholder="Describe your Roblox game..." class="w-full px-5 py-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-indigo-500"></textarea>
          </div>
          <div>
            <label class="block text-base font-medium mb-2">Budget for Promotions ($)</label>
            <input type="number" name="budget" required placeholder="1000" class="w-full px-5 py-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-indigo-500">
          </div>
          <div class="flex gap-6 mt-10">
            <button type="submit" class="flex-1 py-4 btn-primary shadow-glow hover-lift">Submit Application</button>
            <button type="button" onclick="closeOnboardingModal('developer')" class="flex-1 py-4 btn-secondary">Cancel</button>
          </div>
        </form>
      </div>
    </div>
    <!-- Promotion Request Modal -->
    <div id="promotion-request-modal" class="fixed inset-0 bg-black/70 z-[100] hidden flex items-center justify-center p-4 overflow-y-auto">
      <div class="glass max-w-3xl w-full rounded-3xl p-10 m-4 animate-fadeIn shadow-2xl">
        <div class="flex justify-between items-center mb-8">
          <h2 class="text-4xl font-bold gradient-text">Send Promotion Request</h2>
          <button onclick="closePromotionModal()" class="text-3xl hover:text-red-500 transition">&times;</button>
        </div>
        <form id="promotion-request-form" class="space-y-8">
          <div>
            <label class="block text-base font-medium mb-2">Game URL</label>
            <input type="url" name="game_url" required placeholder="https://www.roblox.com/games/..." class="w-full px-5 py-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-indigo-500">
          </div>
          <div>
            <label class="block text-base font-medium mb-2">Budget ($)</label>
            <input type="number" name="budget" required placeholder="500" class="w-full px-5 py-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-indigo-500">
          </div>
          <div>
            <label class="block text-base font-medium mb-2">Niche</label>
            <select name="niche" required class="w-full px-5 py-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-indigo-500">
              <option value="">Select Niche</option>
              <option>Tycoon</option>
              <option>Simulator</option>
              <option>Obby</option>
              <option>Roleplay</option>
              <option>Horror</option>
              <option>PvP</option>
              <option>Adventure</option>
              <option>Fighting</option>
            </select>
          </div>
          <div>
            <label class="block text-base font-medium mb-2">Message</label>
            <textarea name="message" rows="4" placeholder="Additional details..." class="w-full px-5 py-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-indigo-500"></textarea>
          </div>
          <div class="flex gap-6 mt-10">
            <button type="submit" class="flex-1 py-4 btn-primary shadow-glow hover-lift">Send Request</button>
            <button type="button" onclick="closePromotionModal()" class="flex-1 py-4 btn-secondary">Cancel</button>
          </div>
        </form>
      </div>
    </div>
    <!-- Creators Page -->
    <div id="page-creators" class="page hidden">
      <div class="max-w-7xl mx-auto px-6 py-16">
        <div class="mb-12">
          <h1 class="text-5xl font-bold mb-4 gradient-text">Find the Perfect Creator</h1>
          <p class="text-2xl text-gray-600 dark:text-gray-400">Hire verified Roblox YouTubers for authentic promotion</p>
        </div>
        <div class="flex flex-col lg:flex-row gap-10">
          <aside class="lg:w-80 space-y-8 glass p-8 rounded-2xl shadow-glow">
            <h3 class="text-2xl font-bold mb-8 gradient-text">Filters</h3>
            <div class="space-y-8">
              <div>
                <label class="block text-base font-medium mb-2">Search by Name</label>
                <input type="text" id="search-creators" placeholder="Creator name..." class="w-full px-5 py-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-indigo-500">
              </div>
              <div>
                <label class="block text-base font-medium mb-2">Niche</label>
                <select id="filter-niche" class="w-full px-5 py-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-indigo-500">
                  <option value="">All Niches</option>
                  <option>Tycoon</option>
                  <option>Simulator</option>
                  <option>Obby</option>
                  <option>Roleplay</option>
                  <option>Horror</option>
                  <option>PvP</option>
                  <option>Adventure</option>
                  <option>Fighting</option>
                </select>
              </div>
              <div>
                <label class="block text-base font-medium mb-2">Subscribers</label>
                <div class="space-y-3">
                  <label class="flex items-center text-base"><input type="checkbox" value="0-10k" class="mr-3 rounded text-indigo-600 focus:ring-indigo-500">0 - 10k</label>
                  <label class="flex items-center text-base"><input type="checkbox" value="10k-50k" class="mr-3 rounded text-indigo-600 focus:ring-indigo-500">10k - 50k</label>
                  <label class="flex items-center text-base"><input type="checkbox" value="50k-100k" class="mr-3 rounded text-indigo-600 focus:ring-indigo-500">50k - 100k</label>
                  <label class="flex items-center text-base"><input type="checkbox" value="100k+" class="mr-3 rounded text-indigo-600 focus:ring-indigo-500">100k+</label>
                </div>
              </div>
              <div>
                <label class="block text-base font-medium mb-2">Price Range</label>
                <input type="range" min="50" max="10000" value="3000" class="w-full accent-indigo-600" id="price-range">
                <div class="flex justify-between text-base text-gray-600 dark:text-gray-400 mt-3">
                  <span>$50</span>
                  <span id="price-value">$3,000</span>
                  <span>$10,000</span>
                </div>
              </div>
              <button onclick="applyFilters()" class="w-full py-4 btn-primary shadow-glow hover-lift">Apply Filters</button>
            </div>
          </aside>
          <div class="flex-1">
            <div id="creators-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8"></div>
            <div id="empty-creators" class="text-center py-32 text-gray-500 dark:text-gray-400 hidden">
              <p class="text-3xl font-medium mb-6">No creators found</p>
              <p class="text-xl">Try adjusting your filters or check back later.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Creator Profile Page -->
    <div id="page-creator-profile" class="page hidden">
      <div class="max-w-7xl mx-auto px-6 py-16" id="creator-profile-content"></div>
    </div>
    <!-- Auth Page -->
    <div id="page-auth" class="page hidden min-h-screen flex items-center justify-center px-6 bg-gray-50 dark:bg-black">
      <div class="w-full max-w-lg">
        <div class="text-center mb-12">
          <h1 id="auth-title" class="text-5xl font-bold mb-4 gradient-text">Welcome back</h1>
          <p id="auth-subtitle" class="text-2xl text-gray-600 dark:text-gray-400">Log in to your CreatorLink account</p>
        </div>
        <div class="glass p-10 rounded-3xl shadow-2xl">
          <form id="auth-form" class="space-y-8">
            <div>
              <label class="block text-base font-medium mb-2">Email</label>
              <input type="email" id="auth-email" required class="w-full px-5 py-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-indigo-500" placeholder="you@example.com">
            </div>
            <div id="password-field">
              <label class="block text-base font-medium mb-2">Password</label>
              <input type="password" id="auth-password" required class="w-full px-5 py-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-indigo-500" placeholder="••••••••">
            </div>
            <button type="submit" id="auth-submit" class="w-full py-4 btn-primary shadow-glow hover-lift">Log in</button>
          </form>
          <div class="mt-10 text-center">
            <button onclick="toggleAuthMode()" id="auth-toggle" class="text-indigo-600 dark:text-indigo-400 hover:underline text-base font-medium">
              Don't have an account? Sign up
            </button>
          </div>
          <div class="mt-10">
            <button onclick="loginWithDiscord()" class="w-full py-4 bg-indigo-600 hover:bg-indigo-700 text-white text-base font-medium rounded-lg flex items-center justify-center space-x-4 transition shadow-md">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.010c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.010q.186.098.372.292a.077.077 0 0 1-.006.128a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.057c.456-5.272-1.09-9.783-4.318-13.688a.07.07 0 0 0-.03-.027zM8.02 13.795c-1.164 0-2.112-1.058-2.112-2.358s.932-2.358 2.112-2.358c1.19 0 2.137 1.058 2.11 2.358c-.025 1.3-.95 2.358-2.11 2.358zm7.96 0c-1.164 0-2.112-1.058-2.112-2.358s.932-2.358 2.112-2.358c1.19 0 2.137 1.058 2.11 2.358c-.025 1.3-.95 2.358-2.11 2.358z"/></svg>
              <span>Continue with Discord</span>
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Dashboard Page -->
    <div id="page-dashboard" class="page hidden">
      <div class="max-w-7xl mx-auto px-6 py-16">
        <h1 class="text-5xl font-bold mb-12 gradient-text">Dashboard</h1>
        <div id="dashboard-content" class="grid lg:grid-cols-3 gap-10"></div>
      </div>
    </div>
    <!-- Messages Page -->
    <div id="page-messages" class="page hidden">
      <div class="max-w-7xl mx-auto px-6 py-16">
        <h1 class="text-5xl font-bold mb-12 gradient-text">Messages</h1>
        <div class="grid lg:grid-cols-3 gap-8">
          <div id="conversations-list" class="lg:col-span-1 glass p-6 rounded-2xl space-y-4 overflow-y-auto max-h-[70vh]"></div>
          <div id="chat-window" class="lg:col-span-2 glass p-6 rounded-2xl hidden flex flex-col">
            <div id="chat-header" class="text-2xl font-bold mb-6 border-b pb-4"></div>
            <div id="request-menu" class="mb-4 flex space-x-4 hidden"></div>
            <div id="chat-messages" class="flex-1 overflow-y-auto space-y-4 max-h-[50vh]"></div>
            <div class="mt-6 flex">
              <input id="message-input" placeholder="Type your message..." class="flex-1 px-5 py-3 rounded-l-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-indigo-500">
              <button onclick="sendMessage()" class="px-6 py-3 bg-indigo-600 text-white rounded-r-lg hover:bg-indigo-700 transition">Send</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Notifications Page -->
    <div id="page-notifications" class="page hidden">
      <div class="max-w-4xl mx-auto px-6 py-16">
        <h1 class="text-5xl font-bold mb-12 gradient-text">Notifications</h1>
        <div id="notifications-list" class="space-y-6"></div>
      </div>
    </div>
    <!-- Admin Panel -->
    <div id="page-admin" class="page hidden">
      <div class="max-w-7xl mx-auto px-6 py-16">
        <h1 class="text-5xl font-bold mb-12 gradient-text">Admin Panel</h1>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-10">
          <div class="glass p-12 rounded-2xl shadow-glow col-span-full md:col-span-2 lg:col-span-2"> <!-- Bigger panel -->
            <h3 class="text-3xl font-bold mb-6 gradient-text">Pending Creator Applications</h3>
            <div id="admin-pending-creators" class="space-y-6"></div>
          </div>
          <div class="glass p-12 rounded-2xl shadow-glow">
            <h3 class="text-3xl font-bold mb-6 gradient-text">Payout Requests</h3>
            <div id="admin-payouts" class="space-y-6"></div>
          </div>
          <div class="glass p-12 rounded-2xl shadow-glow">
            <h3 class="text-3xl font-bold mb-6 gradient-text">Platform Stats</h3>
            <div id="admin-stats" class="space-y-4 text-xl"></div>
          </div>
        </div>
      </div>
    </div>
    <!-- How It Works Page -->
    <div id="page-how-it-works" class="page hidden">
      <div class="max-w-7xl mx-auto px-6 py-16">
        <h1 class="text-5xl font-bold mb-12 gradient-text">How It Works</h1>
        <div class="space-y-16">
          <div class="flex flex-col md:flex-row items-center gap-10">
            <div class="flex-1">
              <h2 class="text-3xl font-bold mb-4">1. Browse Creators</h2>
              <p class="text-xl text-gray-600 dark:text-gray-300">Find verified Roblox creators that match your game's niche.</p>
            </div>
            <div class="flex-1 bg-gray-200 dark:bg-gray-800 rounded-2xl h-64"></div>
          </div>
          <div class="flex flex-col md:flex-row-reverse items-center gap-10">
            <div class="flex-1">
              <h2 class="text-3xl font-bold mb-4">2. Send Requests</h2>
              <p class="text-xl text-gray-600 dark:text-gray-300">Submit promotion requests and pay securely with Paddle.</p>
            </div>
            <div class="flex-1 bg-gray-200 dark:bg-gray-800 rounded-2xl h-64"></div>
          </div>
          <div class="flex flex-col md:flex-row items-center gap-10">
            <div class="flex-1">
              <h2 class="text-3xl font-bold mb-4">3. Get Results</h2>
              <p class="text-xl text-gray-600 dark:text-gray-300">Watch your player count grow with authentic promotions.</p>
            </div>
            <div class="flex-1 bg-gray-200 dark:bg-gray-800 rounded-2xl h-64"></div>
          </div>
        </div>
      </div>
    </div>
  </main>
  <script>
    // CONFIG
    const SUPABASE_URL = 'https://pchygfliuzwckeizwrit.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBjaHlnZmxpdXp3Y2tlaXp3cml0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4MTA3NTUsImV4cCI6MjA3OTM4Njc1NX0.8AkT2LzUWG1Q5707YokL8m4Lnu1wqGwR2cWKbPDUSe0';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const YOUTUBE_API_KEY = 'AIzaSyD30YdnGH61G6IT4lWb8d3MkyEDbCgRRwo'; // Replace with your YouTube Data API key
    // Paddle Setup (replace with your vendor ID)
    Paddle.Setup({ vendor: 266973 }); // Replace 12345 with your Paddle vendor ID
    // STATE
    let currentUser = null;
    let currentPage = 'home';
    let selectedCreator = null;
    let selectedConversation = null;
    let realtimeSubscriptions = [];
    let filters = { search: '', niche: '', subscribers: [], price: 10000 };
    // UTILITY
    function showError(message) {
      alert(message);
    }
    function toggleElement(id, show) {
      const el = document.getElementById(id);
      if (show === true) el.classList.remove('hidden');
      if (show === false) el.classList.add('hidden');
    }
    // ROUTING
    function route(page, params = {}) {
      realtimeSubscriptions.forEach(sub => sub.unsubscribe());
      realtimeSubscriptions = [];
      document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
      const el = document.getElementById(`page-${page}`);
      if (el) el.classList.remove('hidden');
      currentPage = page;
      switch (page) {
        case 'creators': loadCreators(); break;
        case 'dashboard': loadDashboard(); break;
        case 'messages': loadConversations(); break;
        case 'notifications': loadNotifications(); break;
        case 'admin': loadAdminPanel(); break;
        case 'creator-profile': if (params.id) loadCreatorProfile(params.id); break;
      }
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    window.route = route;
    // AUTH
    async function checkAuth() {
      try {
        const { data: { user } } = await supabase.auth.getUser();
        currentUser = user;
        if (user) {
          let { data: profile } = await supabase
            .from('profiles')
            .select('role, full_name, avatar_url, is_creator, is_developer')
            .eq('id', user.id)
            .maybeSingle();
          if (!profile) {
            const fullName = user.user_metadata?.full_name || user.email.split('@')[0];
            const avatarUrl = user.user_metadata?.avatar_url || 'https://via.placeholder.com/40';
            const { error } = await supabase.from('profiles').insert({
              id: user.id,
              full_name: fullName,
              avatar_url: avatarUrl,
              role: 'user'
            });
            if (error) throw error;
            profile = { role: 'user', full_name: fullName, avatar_url: avatarUrl, is_creator: false, is_developer: false };
          }
          toggleElement('auth-buttons', false);
          toggleElement('user-menu', true);
          toggleElement('nav-dashboard', true);
          document.getElementById('user-name').textContent = profile.full_name;
          document.getElementById('user-avatar').src = profile.avatar_url || 'https://via.placeholder.com/40';
          if (profile.role === 'admin') toggleElement('nav-admin', true);
          await loadNotificationsCount();
        } else {
          toggleElement('auth-buttons', true);
          toggleElement('user-menu', false);
          toggleElement('nav-dashboard', false);
          toggleElement('nav-admin', false);
        }
      } catch (error) {
        console.error('Auth error:', error);
        showError('An error occurred during authentication. Please try again.');
      }
    }
    async function loginWithDiscord() {
      try {
        const { error } = await supabase.auth.signInWithOAuth({ provider: 'discord' });
        if (error) throw error;
      } catch (error) {
        showError(error.message);
      }
    }
    document.getElementById('auth-form')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        const email = document.getElementById('auth-email').value;
        const password = document.getElementById('auth-password').value;
        const isSignup = document.getElementById('auth-submit').textContent.includes('Sign up');
        let error;
        if (isSignup) {
          ({ error } = await supabase.auth.signUp({ email, password }));
          if (!error) showError('Check your email for confirmation link!');
        } else {
          ({ error } = await supabase.auth.signInWithPassword({ email, password }));
          if (!error) route('dashboard');
        }
        if (error) throw error;
      } catch (error) {
        showError(error.message);
      }
    });
    function toggleAuthMode() {
      const isLogin = document.getElementById('auth-title').textContent === 'Welcome back';
      document.getElementById('auth-title').textContent = isLogin ? 'Create your account' : 'Welcome back';
      document.getElementById('auth-subtitle').textContent = isLogin ? 'Join CreatorLink today' : 'Log in to your CreatorLink account';
      document.getElementById('auth-submit').textContent = isLogin ? 'Sign up' : 'Log in';
      document.getElementById('auth-toggle').innerHTML = isLogin ? 'Already have an account? <span class="text-indigo-600 dark:text-indigo-400">Log in</span>' : 'Don\'t have an account? <span class="text-indigo-600 dark:text-indigo-400">Sign up</span>';
    }
    async function logout() {
      try {
        const { error } = await supabase.auth.signOut();
        if (error) throw error;
        realtimeSubscriptions.forEach(sub => sub.unsubscribe());
        realtimeSubscriptions = [];
        route('home');
      } catch (error) {
        showError(error.message);
      }
    }
    // THEME TOGGLE
    document.getElementById('theme-toggle').addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
      localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
    });
    if (localStorage.theme === 'dark' || (!localStorage.theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark');
    }
    // USER MENU
    document.getElementById('user-menu-btn')?.addEventListener('click', (e) => {
      e.stopPropagation();
      e.preventDefault();
      toggleElement('user-dropdown', document.getElementById('user-dropdown').classList.contains('hidden'));
    });
    document.getElementById('dropdown-toggle')?.addEventListener('click', (e) => {
      e.stopPropagation();
      e.preventDefault();
      toggleElement('user-dropdown', document.getElementById('user-dropdown').classList.contains('hidden'));
    });
    document.addEventListener('click', (e) => {
      if (!document.getElementById('user-menu').contains(e.target)) toggleElement('user-dropdown', false);
    });
    // ONBOARDING MODALS
    function openOnboardingModal(type) {
      toggleElement(`onboarding-modal-${type}`, true);
    }
    window.openOnboardingModal = openOnboardingModal;
    function closeOnboardingModal(type) {
      toggleElement(`onboarding-modal-${type}`, false);
    }
    window.closeOnboardingModal = closeOnboardingModal;
    document.getElementById('creator-onboarding-form')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        if (!currentUser) return showError('Please log in first.');
        const formData = new FormData(e.target);
        const niches = Array.from(e.target.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);
        const data = Object.fromEntries(formData);
        data.niches = niches;
        data.user_id = currentUser.id;
        data.is_verified = false;
        data.avatar_url = ''; // Fetch from YT below
        data.example_videos = [];
        data.earnings = 0;
        // Fetch channel info from YouTube
        const channelHandle = data.channel_url.split('/@')[1] || data.channel_url.split('/channel/')[1] || '';
        if (channelHandle) {
          const response = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=snippet&forHandle=${channelHandle}&key=${YOUTUBE_API_KEY}`);
          const ytData = await response.json();
          if (ytData.items && ytData.items[0]) {
            data.avatar_url = ytData.items[0].snippet.thumbnails.high.url;
          }
        }
        const { error } = await supabase.from('creators').insert(data);
        if (error) throw error;
        await supabase.from('profiles').update({ is_creator: true }).eq('id', currentUser.id);
        showError('Application submitted! Await admin approval.');
        closeOnboardingModal('creator');
        route('dashboard');
      } catch (error) {
        showError(error.message);
      }
    });
    document.getElementById('developer-onboarding-form')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        if (!currentUser) return showError('Please log in first.');
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData);
        data.user_id = currentUser.id;
        const { error } = await supabase.from('developers').insert(data);
        if (error) throw error;
        await supabase.from('profiles').update({ is_developer: true }).eq('id', currentUser.id);
        showError('Developer profile created!');
        closeOnboardingModal('developer');
        route('dashboard');
      } catch (error) {
        showError(error.message);
      }
    });
    function openPromotionModal() {
      toggleElement('promotion-request-modal', true);
    }
    window.openPromotionModal = openPromotionModal;
    function closePromotionModal() {
      toggleElement('promotion-request-modal', false);
    }
    window.closePromotionModal = closePromotionModal;
    document.getElementById('promotion-request-form')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        if (!currentUser) return showError('Please log in first.');
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData);
        const { error } = await supabase.from('requests').insert({
          developer_id: currentUser.id,
          creator_id: selectedCreator.user_id,
          status: 'pending',
          price: selectedCreator.price_min,
          game_url: data.game_url,
          budget: data.budget,
          niche: data.niche,
          message: data.message
        });
        if (error) throw error;
        await supabase.from('notifications').insert({
          user_id: selectedCreator.user_id,
          title: 'New Promotion Request',
          message: 'You have a new promotion request from a developer.'
        });
        showError('Request sent!');
        closePromotionModal();
        route('dashboard');
      } catch (error) {
        showError(error.message);
      }
    });
    // CREATORS
    async function loadCreators() {
      try {
        let query = supabase.from('creators').select('*').eq('is_verified', true).order('subscribers', { ascending: false });
        if (filters.search) query = query.ilike('channel_name', `%${filters.search}%`);
        if (filters.niche) query = query.contains('niches', [filters.niche]);
        if (filters.price < 10000) query = query.lte('price_min', filters.price);
        const { data: creators, error } = await query;
        if (error) throw error;
        // Filter subscribers client-side
        if (filters.subscribers.length) {
          creators = creators.filter(c => filters.subscribers.some(range => {
            const [minStr, maxStr] = range.split('-');
            const min = parseInt(minStr.replace('k', '000'));
            const max = maxStr === '+' ? Infinity : parseInt(maxStr.replace('k', '000'));
            return c.subscribers >= min && (max === Infinity || c.subscribers < max);
          }));
        }
        const grid = document.getElementById('creators-grid');
        grid.innerHTML = '';
        toggleElement('empty-creators', creators.length === 0);
        creators.forEach(c => {
          const card = document.createElement('div');
          card.className = 'glass rounded-2xl p-8 hover:shadow-2xl transition cursor-pointer hover-lift shadow-glow';
          card.onclick = () => route('creator-profile', { id: c.id });
          card.innerHTML = `
            <div class="flex justify-between items-start mb-6">
              <img src="${c.avatar_url || 'https://via.placeholder.com/80'}" class="w-20 h-20 rounded-full object-cover border-4 border-indigo-200 dark:border-indigo-800 shadow-sm">
              <div class="text-right">
                <div class="text-3xl font-bold text-indigo-600 dark:text-indigo-400">$${c.price_min || 0}+</div>
                <div class="text-base text-gray-500 dark:text-gray-400">per video</div>
              </div>
            </div>
            <h3 class="text-2xl font-bold mb-3">${c.channel_name || 'Unnamed Creator'}</h3>
            <p class="text-xl text-gray-600 dark:text-gray-400 mb-4">${c.subscribers.toLocaleString() || 0} subscribers</p>
            <div class="flex flex-wrap gap-3 mb-6">
              ${c.niches?.map(n => `<span class="px-4 py-1 bg-indigo-100 dark:bg-indigo-900 text-indigo-600 dark:text-indigo-400 text-sm rounded-full">${n}</span>`).join('') || ''}
            </div>
            <p class="text-base text-gray-500 dark:text-gray-400 line-clamp-3">${c.bio || 'No bio available.'}</p>
          `;
          grid.appendChild(card);
        });
      } catch (error) {
        showError('Failed to load creators.');
      }
    }
    async function loadCreatorProfile(id) {
      try {
        const { data: creator, error } = await supabase.from('creators').select('*').eq('id', id).maybeSingle();
        if (error) throw error;
        if (!creator) return showError('Creator not found.');
        selectedCreator = creator;
        // Fetch recent videos from YouTube if not stored
        let recentVideos = creator.example_videos || [];
        if (recentVideos.length === 0 && YOUTUBE_API_KEY && creator.channel_url) {
          const channelHandle = creator.channel_url.split('/@')[1] || creator.channel_url.split('/channel/')[1] || '';
          if (channelHandle) {
            const channelResponse = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=id&forHandle=${channelHandle}&key=${YOUTUBE_API_KEY}`);
            const channelData = await channelResponse.json();
            if (channelData.items && channelData.items[0]) {
              const channelId = channelData.items[0].id;
              const searchResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&maxResults=3&order=date&type=video&key=${YOUTUBE_API_KEY}`);
              const searchData = await searchResponse.json();
              recentVideos = searchData.items?.map(item => `https://www.youtube.com/watch?v=${item.id.videoId}`) || [];
              // Update in DB
              await supabase.from('creators').update({ example_videos: recentVideos }).eq('id', id);
            }
          }
        }
        document.getElementById('creator-profile-content').innerHTML = `
          <div class="grid lg:grid-cols-3 gap-12">
            <div class="lg:col-span-1 glass p-10 rounded-2xl text-center shadow-glow">
              <img src="${creator.avatar_url || 'https://via.placeholder.com/200'}" class="w-56 h-56 rounded-full mx-auto object-cover border-8 border-indigo-200 dark:border-indigo-800 shadow-lg">
              <h1 class="text-4xl font-bold mt-8 gradient-text">${creator.channel_name}</h1>
              <p class="text-2xl text-gray-600 dark:text-gray-400 mt-2">${creator.subscribers.toLocaleString()} subscribers</p>
              <div class="mt-8">
                <p class="text-4xl font-bold text-indigo-600 dark:text-indigo-400">$${creator.price_min}+</p>
                <p class="text-base text-gray-500 dark:text-gray-400">per sponsored video</p>
              </div>
              <button onclick="openPromotionModal()" class="mt-10 w-full py-4 btn-primary shadow-glow hover-lift">Send Promotion Request</button>
            </div>
            <div class="lg:col-span-2 space-y-10">
              <div class="glass p-10 rounded-2xl shadow-glow">
                <h2 class="text-3xl font-bold mb-6 gradient-text">About</h2>
                <p class="text-xl leading-relaxed">${creator.bio || 'No bio provided.'}</p>
                <div class="mt-8 flex flex-wrap gap-4">
                  ${creator.niches?.map(n => `<span class="px-5 py-2 bg-indigo-100 dark:bg-indigo-900 text-indigo-600 dark:text-indigo-400 rounded-full text-base">${n}</span>`).join('') || ''}
                </div>
              </div>
              <div class="glass p-10 rounded-2xl shadow-glow">
                <h2 class="text-3xl font-bold mb-6 gradient-text">Recent Videos</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  ${recentVideos.map(v => `<iframe src="${v.replace('watch?v=', 'embed/')}" class="rounded-xl aspect-video shadow-sm" frameborder="0" allowfullscreen></iframe>`).join('') || '<p class="text-xl text-gray-500 dark:text-gray-400">No videos available.</p>'}
                </div>
              </div>
            </div>
          </div>
        `;
      } catch (error) {
        showError('Failed to load creator profile.');
      }
    }
    window.applyFilters = () => {
      filters.search = document.getElementById('search-creators').value;
      filters.niche = document.getElementById('filter-niche').value;
      filters.subscribers = Array.from(document.querySelectorAll('#page-creators input[type="checkbox"]:checked')).map(cb => cb.value);
      filters.price = document.getElementById('price-range').value;
      document.getElementById('price-value').textContent = `$${filters.price}`;
      loadCreators();
    };
    // DASHBOARD
    async function loadDashboard() {
      if (!currentUser) return route('auth');
      try {
        const { data: profile } = await supabase.from('profiles').select('is_creator, is_developer').eq('id', currentUser.id).maybeSingle();
        const isCreator = profile.is_creator;
        const isDeveloper = profile.is_developer;
        const content = document.getElementById('dashboard-content');
        content.innerHTML = '';
        if (isCreator) {
          const { data: requests } = await supabase
            .from('requests')
            .select('*, developer:profiles!developer_id (full_name, avatar_url)')
            .eq('creator_id', currentUser.id);
          const { data: creator } = await supabase.from('creators').select('id, niches, earnings').eq('user_id', currentUser.id).maybeSingle();
          if (!creator) {
            content.innerHTML += '<p class="text-red-500 text-xl">Creator profile not found. Please submit an application.</p>';
          } else {
            const activeRequests = requests.filter(r => ['pending', 'accepted', 'completed'].includes(r.status));
            const archiveRequests = requests.filter(r => !['pending', 'accepted', 'completed'].includes(r.status));
            content.innerHTML += `
              <div class="col-span-3">
                <h2 class="text-4xl font-bold mb-8 gradient-text">Creator Dashboard</h2>
                <div class="grid md:grid-cols-3 gap-8 mb-16">
                  <div class="glass p-8 rounded-2xl shadow-glow">
                    <p class="text-base text-gray-500 dark:text-gray-400">Total Earnings</p>
                    <p class="text-5xl font-bold text-green-600 dark:text-green-400">$${creator.earnings || 0}</p>
                    <button onclick="cashOut('${creator.id}')" class="mt-4 px-6 py-2 btn-primary">Cash Out</button>
                  </div>
                  <div class="glass p-8 rounded-2xl shadow-glow">
                    <p class="text-base text-gray-500 dark:text-gray-400">Active Requests</p>
                    <p class="text-5xl font-bold text-indigo-600 dark:text-indigo-400">${activeRequests.length}</p>
                  </div>
                  <div class="glass p-8 rounded-2xl shadow-glow">
                    <p class="text-base text-gray-500 dark:text-gray-400">Completed Videos</p>
                    <p class="text-5xl font-bold text-indigo-600 dark:text-indigo-400">${requests.filter(r => r.status === 'paid').length}</p>
                  </div>
                </div>
                <div class="glass p-10 rounded-2xl shadow-glow mb-10">
                  <h3 class="text-3xl font-bold mb-6 gradient-text">Set Your Price</h3>
                  <input type="number" id="creator-price" placeholder="Enter price per video" class="w-full px-5 py-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-indigo-500 mb-6">
                  <button onclick="setCreatorPrice('${creator.id}')" class="w-full py-4 btn-primary shadow-glow hover-lift">Save Price</button>
                </div>
                <div class="glass p-10 rounded-2xl shadow-glow">
                  <h3 class="text-3xl font-bold mb-6 gradient-text">Incoming Requests</h3>
                  <div class="flex space-x-4 mb-4">
                    <span class="tab active" onclick="toggleTabs('active')">Active</span>
                    <span class="tab" onclick="toggleTabs('archive')">Archive</span>
                  </div>
                  <div id="active-requests" class="space-y-6">
                    ${activeRequests.map(r => `
                      <div class="request-card">
                        <p class="text-xl font-medium">From: ${r.developer?.full_name || 'Unknown Developer'}</p>
                        <p class="text-base">Status: ${r.status}</p>
                        <p class="text-base">Niche: ${r.niche}</p>
                        <p class="text-base">Game URL: ${r.game_url}</p>
                        <p class="text-base">Budget: $${r.budget}</p>
                        <p class="text-base">Message: ${r.message}</p>
                        ${r.status === 'pending' ? `
                          <button onclick="acceptRequest('${r.id}', '${r.developer_id}')" class="mt-4 px-6 py-2 btn-primary mr-4">Accept</button>
                          <button onclick="rejectRequest('${r.id}')" class="mt-4 px-6 py-2 btn-secondary">Reject</button>
                        ` : ''}
                        ${r.status === 'accepted' ? `
                          <button onclick="markCompleted('${r.id}')" class="mt-4 px-6 py-2 btn-primary mr-4">Mark Completed</button>
                          <button onclick="cancelRequest('${r.id}')" class="mt-4 px-6 py-2 btn-secondary">Cancel</button>
                        ` : ''}
                        ${r.status === 'completed' ? '<p class="text-base text-yellow-600">Awaiting Payment</p>' : ''}
                      </div>
                    `).join('') || '<p class="text-xl text-gray-500 dark:text-gray-400">No active requests.</p>'}
                  </div>
                  <div id="archive-requests" class="space-y-6 hidden archive-section">
                    ${archiveRequests.map(r => `
                      <div class="request-card">
                        <p class="text-xl font-medium">From: ${r.developer?.full_name || 'Unknown Developer'}</p>
                        <p class="text-base">Status: ${r.status}</p>
                        <p class="text-base">Niche: ${r.niche}</p>
                        <p class="text-base">Game URL: ${r.game_url}</p>
                        <p class="text-base">Budget: $${r.budget}</p>
                        <p class="text-base">Message: ${r.message}</p>
                      </div>
                    `).join('') || '<p class="text-xl text-gray-500 dark:text-gray-400">No archived requests.</p>'}
                  </div>
                </div>
              </div>
            `;
          }
          // Real-time subscription for requests
          const requestsSub = supabase.channel('requests-changes')
            .on('postgres_changes', { event: '*', schema: 'public', table: 'requests', filter: `creator_id=eq.${currentUser.id}` }, () => {
              loadDashboard();
            })
            .subscribe();
          realtimeSubscriptions.push(requestsSub);
        }
        if (isDeveloper) {
          const { data: requests } = await supabase
            .from('requests')
            .select('*, creator:profiles!creator_id (full_name)')
            .eq('developer_id', currentUser.id);
          content.innerHTML += `
            <div class="col-span-3">
              <h2 class="text-4xl font-bold mb-8 gradient-text">Developer Dashboard</h2>
              <div class="glass p-10 rounded-2xl shadow-glow">
                <h3 class="text-3xl font-bold mb-6 gradient-text">Your Requests</h3>
                <div id="developer-requests" class="space-y-6">
                  ${requests.map(r => `
                    <div class="request-card">
                      <p class="text-xl font-medium">To: ${r.creator?.full_name || 'Unknown Creator'}</p>
                      <p class="text-base">Status: ${r.status}</p>
                      <p class="text-base">Price: $${r.price}</p>
                      ${r.status === 'completed' ? `<button onclick="payRequest('${r.id}', ${r.price})" class="mt-4 px-6 py-2 btn-primary">Pay Now</button>` : ''}
                      ${['accepted', 'completed'].includes(r.status) ? `<button onclick="cancelRequest('${r.id}')" class="mt-4 px-6 py-2 btn-secondary ml-4">Cancel</button>` : ''}
                    </div>
                  `).join('') || '<p class="text-xl text-gray-500 dark:text-gray-400">No requests yet.</p>'}
                </div>
              </div>
            </div>
          `;
          // Real-time subscription for requests
          const requestsSub = supabase.channel('requests-changes')
            .on('postgres_changes', { event: '*', schema: 'public', table: 'requests', filter: `developer_id=eq.${currentUser.id}` }, () => {
              loadDashboard();
            })
            .subscribe();
          realtimeSubscriptions.push(requestsSub);
        }
        if (!isCreator && !isDeveloper) {
          content.innerHTML = `
            <div class="col-span-3 text-center py-32">
              <h2 class="text-4xl font-bold mb-8 gradient-text">Welcome to CreatorLink!</h2>
              <p class="text-2xl text-gray-600 dark:text-gray-400 mb-16">What would you like to do?</p>
              <div class="flex justify-center gap-10">
                <button onclick="openOnboardingModal('creator')" class="px-10 py-5 btn-primary text-xl shadow-glow hover-lift">Become a Creator</button>
                <button onclick="openOnboardingModal('developer')" class="px-10 py-5 btn-secondary text-xl shadow-glow hover-lift">Hire Creators</button>
              </div>
            </div>
          `;
        }
      } catch (error) {
        console.error('Dashboard load error:', error);
        showError('Failed to load dashboard. Check console for details.');
      }
    }
    window.toggleTabs = (tab) => {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      toggleElement('active-requests', tab === 'active');
      toggleElement('archive-requests', tab === 'archive');
    };
    window.setCreatorPrice = async (creatorId) => {
      try {
        const price = document.getElementById('creator-price').value;
        if (!price || price < 0) return showError('Invalid price');
        const { error } = await supabase.from('creators').update({ price_min: price }).eq('id', creatorId);
        if (error) throw error;
        showError('Price updated!');
      } catch (error) {
        showError(error.message);
      }
    };
    window.acceptRequest = async (id, developerId) => {
      try {
        const { data: devProfile } = await supabase.from('profiles').select('full_name').eq('id', developerId).single();
        const devName = devProfile?.full_name || 'Developer';

        await supabase.from('requests').update({ status: 'accepted' }).eq('id', id);
        await supabase.from('messages').insert({
          sender_id: currentUser.id,
          receiver_id: developerId,
          content: 'Request accepted! Let\'s discuss the details.'
        });
        await supabase.from('notifications').insert({
          user_id: developerId,
          title: 'Request Accepted',
          message: 'Your promotion request has been accepted by the creator.'
        });

        loadDashboard();
        showError('Request accepted! Opening chat...');
        route('messages');
        setTimeout(() => openChat(developerId, devName), 800);
      } catch (error) {
        showError(error.message);
      }
    };
    window.rejectRequest = async (id) => {
      try {
        const { data: request } = await supabase.from('requests').select('developer_id').eq('id', id).single();
        await supabase.from('requests').update({ status: 'rejected' }).eq('id', id);
        await supabase.from('notifications').insert({
          user_id: request.developer_id,
          title: 'Request Rejected',
          message: 'Your promotion request has been rejected by the creator.'
        });
        loadDashboard();
      } catch (error) {
        showError(error.message);
      }
    };
    window.markCompleted = async (id) => {
      try {
        const { data: request } = await supabase.from('requests').select('developer_id').eq('id', id).single();
        const { error } = await supabase.from('requests').update({ status: 'completed' }).eq('id', id);
        if (error) throw error;
        // Send message in chat if in messages page
        if (selectedConversation) {
          await supabase.from('messages').insert({
            sender_id: currentUser.id,
            receiver_id: selectedConversation,
            content: 'Request marked as completed. Awaiting payment.'
          });
        }
        // Notify developer
        await supabase.from('notifications').insert({
          user_id: request.developer_id,
          title: 'Request Completed',
          message: 'The creator has marked the promotion as completed. Please make the payment.'
        });
        loadDashboard();
        if (currentPage === 'messages') loadConversations(); // Refresh if in messages
      } catch (error) {
        showError(error.message);
      }
    };
    window.cancelRequest = async (id) => {
      try {
        const { data: request } = await supabase.from('requests').select('developer_id, creator_id').eq('id', id).single();
        const { error } = await supabase.from('requests').update({ status: 'cancelled' }).eq('id', id);
        if (error) throw error;
        const otherId = currentUser.id === request.developer_id ? request.creator_id : request.developer_id;
        const role = currentUser.id === request.developer_id ? 'Developer' : 'Creator';
        // Send message in chat if in messages page
        if (selectedConversation) {
          await supabase.from('messages').insert({
            sender_id: currentUser.id,
            receiver_id: selectedConversation,
            content: 'Request cancelled.'
          });
        }
        // Notify other party
        await supabase.from('notifications').insert({
          user_id: otherId,
          title: 'Request Cancelled',
          message: `The ${role} has cancelled the promotion request.`
        });
        loadDashboard();
        if (currentPage === 'messages') loadConversations(); // Refresh if in messages
      } catch (error) {
        showError(error.message);
      }
    };
    window.payRequest = async (id, price) => {
      try {
        Paddle.Checkout.open({
          items: [{
            priceId: 'pro_01kapataxntj7jd742w3srq0g8', // Replace with your Paddle price ID
            quantity: 1
          }],
          customer: {
            email: currentUser.email
          },
          successCallback: async (data) => {
            const { data: request } = await supabase.from('requests').select('creator_id').eq('id', id).single();
            await supabase.from('requests').update({ status: 'paid' }).eq('id', id);
            // Update creator earnings
            const { data: creator } = await supabase.from('creators').select('earnings').eq('user_id', request.creator_id).single();
            const newEarnings = (creator.earnings || 0) + (price * 0.85);
            await supabase.from('creators').update({ earnings: newEarnings }).eq('user_id', request.creator_id);
            // Notify creator
            await supabase.from('notifications').insert({
              user_id: request.creator_id,
              title: 'Payment Received',
              message: `You have received payment of $${price} for the promotion. Earnings updated.`
            });
            showError('Payment successful!');
            loadDashboard();
          }
        });
      } catch (error) {
        showError(error.message);
      }
    };
    window.cashOut = async (creatorId) => {
      try {
        const { data: creator } = await supabase.from('creators').select('earnings').eq('id', creatorId).single();
        if (creator.earnings <= 0) return showError('No earnings to cash out.');
        // Simulate cash out
        await supabase.from('creators').update({ earnings: 0 }).eq('id', creatorId);
        showError('Cash out requested! (85% transferred)');
      } catch (error) {
        showError(error.message);
      }
    };
    // MESSAGING
    async function loadConversations() {
      try {
        const { data: messages } = await supabase
          .from('messages')
          .select('*, sender:profiles!sender_id (full_name), receiver:profiles!receiver_id (full_name)')
          .or(`sender_id.eq.${currentUser.id},receiver_id.eq.${currentUser.id}`)
          .order('created_at', { ascending: false });
        const list = document.getElementById('conversations-list');
        list.innerHTML = '';
        const uniqueConvos = new Map();
        messages.forEach(m => {
          const otherId = m.sender_id === currentUser.id ? m.receiver_id : m.sender_id;
          const otherName = m.sender_id === currentUser.id ? m.receiver?.full_name : m.sender?.full_name;
          if (!uniqueConvos.has(otherId)) {
            uniqueConvos.set(otherId, { id: otherId, name: otherName || 'User' });
          }
        });
        uniqueConvos.forEach(conv => {
          const item = document.createElement('div');
          item.className = 'p-5 hover:bg-indigo-100 dark:hover:bg-indigo-900 cursor-pointer rounded-lg transition';
          item.onclick = () => openChat(conv.id, conv.name);
          item.innerHTML = `<p class="text-xl font-medium">${conv.name}</p>`;
          list.appendChild(item);
        });
        // Real-time subscription for new messages
        const messagesSub = supabase.channel('messages-changes')
          .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages', filter: `receiver_id=eq.${currentUser.id}` }, () => {
            loadConversations();
          })
          .subscribe();
        realtimeSubscriptions.push(messagesSub);
      } catch (error) {
        console.error('Failed to load conversations:', error);
        showError('Failed to load conversations.');
      }
    }
    async function openChat(userId, userName) {
      selectedConversation = userId;
      toggleElement('chat-window', true);
      document.getElementById('chat-header').innerHTML = `<span class="gradient-text">Chat with ${userName}</span>`;
      try {
        const { data: msgs } = await supabase
          .from('messages')
          .select('*')
          .or(`and(sender_id.eq.${currentUser.id},receiver_id.eq.${userId}),and(sender_id.eq.${userId},receiver_id.eq.${currentUser.id})`)
          .order('created_at');
        const chat = document.getElementById('chat-messages');
        chat.innerHTML = '';
        msgs.forEach(m => {
          const div = document.createElement('div');
          div.className = m.sender_id === currentUser.id ? 'text-right' : 'text-left';
          div.innerHTML = `<div class="${m.sender_id === currentUser.id ? 'bg-indigo-600 text-white' : 'bg-gray-200 dark:bg-gray-800 text-gray-900 dark:text-white'} inline-block px-5 py-3 rounded-lg max-w-md shadow-sm">${m.content}</div>`;
          chat.appendChild(div);
        });
        chat.scrollTop = chat.scrollHeight;
        // Fetch related request
        let query = supabase.from('requests').select('*');
        if (await isCreator()) {
          query = query.eq('creator_id', currentUser.id).eq('developer_id', userId);
        } else {
          query = query.eq('developer_id', currentUser.id).eq('creator_id', userId);
        }
        const { data: requests } = await query;
        const request = requests[0]; // Assume one active request per pair
        const menu = document.getElementById('request-menu');
        menu.innerHTML = '';
        if (request && ['accepted', 'completed'].includes(request.status)) {
          if (await isCreator()) {
            if (request.status === 'accepted') {
              menu.innerHTML += `<button onclick="markCompleted('${request.id}')" class="px-4 py-2 btn-primary">Mark Completed</button>`;
            } else if (request.status === 'completed') {
              menu.innerHTML += `<span class="text-yellow-600">Awaiting Payment</span>`;
            }
          } else {
            if (request.status === 'completed') {
              menu.innerHTML += `<button onclick="payRequest('${request.id}', ${request.price})" class="px-4 py-2 btn-primary">Pay Now</button>`;
            }
          }
          if (request.status !== 'paid') {
            menu.innerHTML += `<button onclick="cancelRequest('${request.id}')" class="px-4 py-2 btn-secondary ml-2">Cancel Request</button>`;
          }
          toggleElement('request-menu', true);
        } else {
          toggleElement('request-menu', false);
        }
        // Real-time
        const sub = supabase.channel(`chat:${[currentUser.id, userId].sort().join('-')}`)
          .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, payload => {
            if ((payload.new.sender_id === userId && payload.new.receiver_id === currentUser.id) || (payload.new.sender_id === currentUser.id && payload.new.receiver_id === userId)) {
              const div = document.createElement('div');
              div.className = payload.new.sender_id === currentUser.id ? 'text-right' : 'text-left';
              div.innerHTML = `<div class="${payload.new.sender_id === currentUser.id ? 'bg-indigo-600 text-white' : 'bg-gray-200 dark:bg-gray-800 text-gray-900 dark:text-white'} inline-block px-5 py-3 rounded-lg max-w-md shadow-sm">${payload.new.content}</div>`;
              chat.appendChild(div);
              chat.scrollTop = chat.scrollHeight;
            }
          })
          .subscribe();
        realtimeSubscriptions.push(sub);
      } catch (error) {
        showError('Failed to load chat.');
      }
    }
    async function isCreator() {
      const { data: profile } = await supabase.from('profiles').select('is_creator').eq('id', currentUser.id).single();
      return profile.is_creator;
    }
    async function sendMessage() {
      const input = document.getElementById('message-input');
      const content = input.value.trim();
      if (!content || !selectedConversation) return;
      try {
        const { error } = await supabase.from('messages').insert({
          sender_id: currentUser.id,
          receiver_id: selectedConversation,
          content
        });
        if (error) throw error;
        input.value = '';
      } catch (error) {
        showError(error.message);
      }
    }
    window.sendMessage = sendMessage;
    // NOTIFICATIONS
    async function loadNotificationsCount() {
      try {
        const { count } = await supabase
          .from('notifications')
          .select('id', { count: 'exact', head: true })
          .eq('user_id', currentUser.id)
          .eq('read', false);
        const badge = document.getElementById('notif-badge');
        if (count > 0) {
          badge.textContent = count;
          badge.classList.remove('hidden');
        } else {
          badge.classList.add('hidden');
        }
      } catch (error) {
        console.error(error);
      }
    }
    async function loadNotifications() {
      try {
        const { data: notifs } = await supabase
          .from('notifications')
          .select('*')
          .eq('user_id', currentUser.id)
          .order('created_at', { ascending: false });
        const list = document.getElementById('notifications-list');
        list.innerHTML = notifs.map(n => `
          <div class="glass p-8 rounded-2xl shadow-glow ${!n.read ? 'border-l-4 border-indigo-600' : ''}">
            <p class="text-2xl font-medium mb-2">${n.title}</p>
            <p class="text-xl text-gray-600 dark:text-gray-300 mb-4">${n.message}</p>
            <p class="text-base text-gray-500 dark:text-gray-400">${new Date(n.created_at).toLocaleString()}</p>
          </div>
        `).join('') || '<p class="text-center text-2xl text-gray-500 dark:text-gray-400 py-16">No notifications yet.</p>';
        await supabase.from('notifications').update({ read: true }).eq('user_id', currentUser.id).eq('read', false);
        loadNotificationsCount();
        // Real-time subscription for notifications
        const notifsSub = supabase.channel('notifications-changes')
          .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'notifications', filter: `user_id=eq.${currentUser.id}` }, () => {
            loadNotifications();
          })
          .subscribe();
        realtimeSubscriptions.push(notifsSub);
      } catch (error) {
        showError('Failed to load notifications.');
      }
    }
    // ADMIN PANEL
    async function loadAdminPanel() {
      if (!currentUser) return route('auth');
      try {
        const { data: profile } = await supabase.from('profiles').select('role').eq('id', currentUser.id).maybeSingle();
        if (profile.role !== 'admin') return route('dashboard');
        // Pending creators
        const { data: pending } = await supabase.from('creators').select('*').eq('is_verified', false);
        document.getElementById('admin-pending-creators').innerHTML = pending.map(c => `
          <div class="p-6 bg-white/50 dark:bg-black/50 rounded-xl space-y-4">
            <p class="text-xl font-medium">${c.channel_name} (${c.subscribers} subs)</p>
            <p class="text-base">${c.bio.slice(0, 100)}...</p>
            <div class="flex gap-4">
              <button onclick="verifyCreator('${c.id}', true)" class="px-6 py-2 btn-primary">Approve</button>
              <button onclick="verifyCreator('${c.id}', false)" class="px-6 py-2 btn-secondary">Deny</button>
            </div>
          </div>
        `).join('') || '<p class="text-xl text-gray-500 dark:text-gray-400">No pending applications.</p>';
        // Payouts stub
        document.getElementById('admin-payouts').innerHTML = '<p class="text-xl text-gray-500 dark:text-gray-400">No payout requests.</p>';
        // Stats
        const { count: userCount } = await supabase.from('profiles').select('id', { count: 'exact' });
        const { count: creatorCount } = await supabase.from('creators').select('id', { count: 'exact' });
        const { count: requestCount } = await supabase.from('requests').select('id', { count: 'exact' });
        document.getElementById('admin-stats').innerHTML = `
          <p>Total Users: ${userCount}</p>
          <p>Creators: ${creatorCount}</p>
          <p>Requests: ${requestCount}</p>
        `;
      } catch (error) {
        showError('Failed to load admin panel.');
      }
    }
    window.verifyCreator = async (id, approve) => {
      try {
        const { data: creator } = await supabase.from('creators').select('user_id').eq('id', id).single();
        const updates = { is_verified: approve };
        const { error } = await supabase.from('creators').update(updates).eq('id', id);
        if (error) throw error;
        if (approve) {
          await supabase.from('profiles').update({ is_creator: true }).eq('id', creator.user_id);
        }
        loadAdminPanel();
      } catch (error) {
        showError(error.message);
      }
    };
    // PROMO REQUESTS
    window.startRequest = async (creatorId) => {
      selectedCreator.id = creatorId; // To pass to modal submit
      openPromotionModal();
    };
    // INITIAL LOAD
    window.addEventListener('load', async () => {
      await checkAuth();
      supabase.auth.onAuthStateChange(async (_, session) => {
        currentUser = session?.user ?? null;
        await checkAuth();
        route(currentPage);
      });
      const priceRange = document.getElementById('price-range');
      if (priceRange) priceRange.addEventListener('input', () => document.getElementById('price-value').textContent = `$${priceRange.value}`);
    });
  </script>
</body>
</html>